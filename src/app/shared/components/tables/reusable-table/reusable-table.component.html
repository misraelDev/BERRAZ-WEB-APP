<div class="overflow-hidden rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
  @if (!hideHeader) {
    <div class="flex flex-col gap-4 px-4 pb-3 pt-4 border-b border-gray-100 dark:border-white/5 sm:px-6 sm:flex-row sm:items-center sm:justify-between">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
        @if (searchKeys.length > 0) {
          <div class="relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 flex items-center text-gray-400 dark:text-gray-500" [innerHTML]="searchIcon | safeHtml"></span>
            <input
              type="text"
              [placeholder]="searchPlaceholder"
              [value]="searchTerm()"
              (input)="onSearchChange($any($event.target).value)"
              class="h-9 w-full sm:w-64 pl-9 pr-3 text-sm rounded-lg border border-gray-300 bg-white text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
            />
          </div>
        }
      </div>

      <div class="flex items-center gap-2">
        @if (onExport !== undefined) {
          <button
            type="button"
            (click)="handleExportCSV()"
            class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200"
          >
            <span [innerHTML]="downloadIcon | safeHtml"></span>
            {{ exportButtonLabel }}
          </button>
        }
        @if (onAdd !== undefined) {
          <button
            type="button"
            (click)="handleAdd()"
            class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200"
          >
            <span [innerHTML]="plusIcon | safeHtml"></span>
            {{ addButtonLabel }}
          </button>
        }
      </div>
    </div>
  }

  <div class="max-w-full overflow-x-auto">
    <table class="w-full text-left">
      <thead class="border-y border-gray-100 dark:border-gray-800">
        <tr>
          @for (column of allColumns(); track column.key) {
            <th [class]="'px-4 py-3 font-medium text-gray-500 text-theme-xs dark:text-gray-400 ' + (column.className || '')">
              @if (column.sortable) {
                <button
                  type="button"
                  (click)="handleSort(column.key)"
                  class="flex items-center gap-2 hover:text-gray-700 dark:hover:text-gray-300 transition-colors"
                >
                  {{ column.label }}
                  <span [innerHTML]="getSortIcon(column.key) | safeHtml"></span>
                </button>
              } @else {
                {{ column.label }}
              }
            </th>
          }
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
        @if (paginatedData().length > 0) {
          @for (item of paginatedData(); track item.id) {
            <tr>
              @for (column of allColumns(); track column.key) {
                <td [class]="'px-4 py-3 text-gray-500 text-theme-sm dark:text-gray-400 ' + (column.className || '')">
                  @if (column.render) {
                    <span [innerHTML]="column.render(item) | safeHtml"></span>
                  } @else if (column.subValue) {
                    <div>
                      <div class="block text-gray-700 text-theme-sm dark:text-white/90">
                        @if (column.formatValue) {
                          <span [innerHTML]="getFormattedValue(column, item) | safeHtml"></span>
                        } @else {
                          {{ getRawValue(column, item) }}
                        }
                      </div>
                      @if (getSubValue(column, item)) {
                        <span 
                          [class]="'block text-gray-500 text-theme-xs dark:text-gray-400 ' + (column.subValueClassName || '')"
                          [innerHTML]="(getSubValue(column, item) || '') | safeHtml"
                        >
                        </span>
                      }
                    </div>
                  } @else {
                    @if (column.formatValue) {
                      <span [innerHTML]="getFormattedValue(column, item) | safeHtml"></span>
                    } @else {
                      {{ getRawValue(column, item) }}
                    }
                  }
                </td>
              }
            </tr>
          }
        } @else {
          <tr>
            <td [attr.colspan]="allColumns().length" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
              No hay resultados
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (!hidePagination) {
    <div class="flex items-center justify-between px-4 py-4 border-t border-gray-100 dark:border-white/5 sm:px-6">
      <div class="text-sm text-gray-700 dark:text-gray-300">
        <span class="font-medium">{{ sortedData().length }}</span> de
        <span class="font-medium">{{ data.length }}</span> registro(s)
      </div>

      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2">
          <span class="text-sm text-gray-700 dark:text-gray-300">Mostrando:</span>
          <select
            [value]="itemsPerPage().toString()"
            (change)="handleItemsPerPageChange($any($event.target).value)"
            class="h-8 w-16 px-2 py-1 text-sm appearance-none rounded-lg border border-gray-300 bg-transparent text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800 text-center"
          >
            <option value="5" class="text-gray-700 dark:bg-gray-900 dark:text-gray-400">5</option>
            <option value="10" class="text-gray-700 dark:bg-gray-900 dark:text-gray-400">10</option>
            <option value="20" class="text-gray-700 dark:bg-gray-900 dark:text-gray-400">20</option>
            <option value="50" class="text-gray-700 dark:bg-gray-900 dark:text-gray-400">50</option>
          </select>
          <span class="text-sm text-gray-700 dark:text-gray-300">registros por página</span>
        </div>

        <div class="flex items-center gap-1">
          <button
            type="button"
            (click)="previousPage()"
            [disabled]="currentPage() === 1"
            class="inline-flex items-center justify-center w-8 h-8 rounded-lg border border-gray-300 bg-white px-2 py-1 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200"
          >
            <span [innerHTML]="chevronLeftIcon | safeHtml"></span>
          </button>
          <span class="text-sm text-gray-700 dark:text-gray-300 px-2">
            Página {{ currentPage() }} de {{ totalPages() || 1 }}
          </span>
          <button
            type="button"
            (click)="nextPage()"
            [disabled]="currentPage() === totalPages()"
            class="inline-flex items-center justify-center w-8 h-8 rounded-lg border border-gray-300 bg-white px-2 py-1 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 disabled:opacity-50 disabled:cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200"
          >
            <span [innerHTML]="chevronRightIcon | safeHtml"></span>
          </button>
        </div>
      </div>
    </div>
  }
</div>
